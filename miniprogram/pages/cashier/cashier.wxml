<navigation-bar
  title="åœºæ§æ”¶é“¶"
  back="{{true}}"
  color="black"
  background="#FFF"
>
</navigation-bar>
<scroll-view
  class="scrollarea"
  scroll-y
  type="list"
>
  <view class="container">
    <!-- æ—¥æœŸé€‰æ‹© -->
    <view class="header-picker">
      <picker
        mode="date"
        value="{{selectedDate}}"
        bindchange="onDateChange"
      >
        <view class="date-display">
          <text class="calendar-icon">ğŸ“…</text>
          <text class="date-text">{{selectedDate}}</text>
          <text class="arrow-down">â–¼</text>
        </view>
      </picker>
    </view>
    <!-- å‘˜å·¥æ’é’Ÿè¡¨ -->
    <view class="section timeline-section">
      <view class="section-header">
        <text class="section-title">æ’é’Ÿè¿›åº¦ (12:00 - 23:00)</text>
        <view class="reserve-btn" bindtap="openReserveModal">æ–°å¢é¢„çº¦</view>
      </view>
      <scroll-view class="timeline-scroll" scroll-x>
        <view class="timeline-container">
          <!-- æ—¶é—´è½´åˆ»åº¦ -->
          <view class="time-axis">
            <view class="time-axis-spacer">
            </view>
            <view
              class="time-mark"
              wx:for="{{timeLabels}}"
              wx:key="*this"
            >
              {{item}}
            </view>
          </view>
          <!-- å‘˜å·¥è¡Œ -->
          <view
            class="staff-timeline-row"
            wx:for="{{staffTimeline}}"
            wx:key="id"
          >
            <view class="staff-name-col">
              <text>{{item.name}}</text>
              <text class="shift-mini-tag {{item.shift}}">{{item.shift === 'morning' ? 'æ—©' : 'æ™š'}}</text>
            </view>
            <view class="timeline-track">
              <!-- èƒŒæ™¯ç½‘æ ¼çº¿ -->
              <view
                class="grid-line"
                wx:for="{{timeLabels}}"
                wx:key="*this"
              >
              </view>
              <!-- å ç”¨å— -->
              <view
                class="time-block {{block.isReservation ? 'reservation' : ''}}"
                wx:for="{{item.blocks}}"
                wx:for-item="block"
                wx:key="startTime"
                style="left: {{block.left}}; width: {{block.width}};"
              >
                <view class="block-content">
                  <text class="block-customer">{{block.customerName}}</text>
                  <text class="block-time">{{block.startTime}}-{{block.endTime}}</text>
                  <text class="block-info">{{block.project}} | {{block.room}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
    <!-- æˆ¿é—´çŠ¶æ€ -->
    <view class="section">
      <view class="section-title">æˆ¿é—´çŠ¶æ€</view>
      <view class="room-grid">
        <view
          class="room-item {{item.isOccupied ? 'occupied' : 'empty'}}"
          wx:for="{{rooms}}"
          wx:key="name"
        >
          <view class="room-name">{{item.name}}</view>
          <view class="room-status">{{item.isOccupied ? 'å ç”¨' : 'ç©ºé—²'}}</view>
          <view class="room-detail" wx:if="{{item.isOccupied}}">
            <text class="staff-tag">{{item.technician}}</text>
            <text class="time-tag">{{item.endTime}}</text>
          </view>
        </view>
      </view>
    </view>
    <!-- å‘˜å·¥è½®æ’ -->
    <view class="section">
      <view class="section-title">ä»Šæ—¥è½®æ’</view>
      <view class="rotation-list" wx:if="{{rotationList.length > 0}}">
        <view
          class="rotation-item"
          wx:for="{{rotationList}}"
          wx:key="id"
        >
          <view class="rank-num">{{index + 1}}</view>
          <view class="staff-info">
            <text class="staff-name">{{item.name}}</text>
            <text class="shift-tag {{item.shift}}">{{item.shiftLabel}}</text>
          </view>
          <view class="action-btns">
            <view
              class="btn move-up {{index === 0 ? 'disabled' : ''}}"
              bindtap="moveRotation"
              data-index="{{index}}"
              data-direction="up"
            >
              <text>â†‘</text>
            </view>
            <view
              class="btn move-down {{index === rotationList.length - 1 ? 'disabled' : ''}}"
              bindtap="moveRotation"
              data-index="{{index}}"
              data-direction="down"
            >
              <text>â†“</text>
            </view>
          </view>
        </view>
      </view>
      <view class="empty-hint" wx:else>ä»Šæ—¥æš‚æ— ä¸Šç­æ’ç­</view>
    </view>
  </view>
</scroll-view>
<!-- é¢„çº¦å¼¹çª— -->
<view
  class="modal-mask"
  wx:if="{{showReserveModal}}"
  bindtap="closeReserveModal"
>
  <view class="modal-content" catchtap="stopBubble">
    <view class="modal-header">æ–°å¢é¢„çº¦</view>
    <view class="modal-body">
      <view class="form-item">
        <text class="label">æ—¥æœŸ</text>
        <picker
          mode="date"
          value="{{reserveForm.date}}"
          bindchange="onReserveFieldChange"
          data-field="date"
        >
          <view class="picker-val">{{reserveForm.date}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="label">é¡¾å®¢å§“å</text>
        <input
          class="input"
          placeholder="é€‰å¡«"
          value="{{reserveForm.customerName}}"
          bindinput="onReserveFieldChange"
          data-field="customerName" />
      </view>
      <view class="form-item">
        <text class="label">æ€§åˆ«</text>
        <view class="radio-group">
          <view
            class="radio-item {{reserveForm.gender === 'male' ? 'selected' : ''}}"
            bindtap="setReserveGender"
            data-gender="male"
          >
            å…ˆç”Ÿ
          </view>
          <view
            class="radio-item {{reserveForm.gender === 'female' ? 'selected' : ''}}"
            bindtap="setReserveGender"
            data-gender="female"
          >
            å¥³å£«
          </view>
        </view>
      </view>
      <view class="form-item">
        <text class="label">é¡¹ç›®</text>
        <picker
          mode="selector"
          range="{{projects}}"
          bindchange="onReserveFieldChange"
          data-field="project"
        >
          <view class="picker-val">{{reserveForm.project || 'ç‚¹å‡»é€‰æ‹©é¡¹ç›®ï¼ˆé€‰å¡«ï¼‰'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="label">æ‰‹æœºå·</text>
        <input
          class="input"
          type="number"
          maxlength="11"
          placeholder="é€‰å¡«"
          value="{{reserveForm.phone}}"
          bindinput="onReserveFieldChange"
          data-field="phone" />
      </view>
      <view class="form-item technician-item">
        <text class="label">æŠ€å¸ˆ</text>
        <view class="technician-grid">
          <view
            class="tech-tag {{reserveForm.technicianId === item.id ? 'selected' : ''}} {{item.isOccupied ? 'occupied' : ''}}"
            wx:for="{{staffAvailability}}"
            wx:key="id"
            bindtap="selectReserveTechnician"
            data-id="{{item.id}}"
            data-name="{{item.name}}"
            data-occupied="{{item.isOccupied}}"
          >
            {{item.name}}
          </view>
        </view>
      </view>
      <view class="form-item">
        <text class="label">å¼€å§‹æ—¶é—´</text>
        <picker
          mode="time"
          value="{{reserveForm.startTime}}"
          bindchange="onReserveFieldChange"
          data-field="startTime"
        >
          <view class="picker-val">{{reserveForm.startTime}}</view>
        </picker>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="closeReserveModal">å–æ¶ˆ</button>
      <button class="btn-confirm" bindtap="confirmReserve">ç¡®å®š</button>
    </view>
  </view>
</view>
